<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Models comparison • clmplus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Models comparison">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clmplus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/casestudy1.html">Vignette 1</a></li>
    <li><a class="dropdown-item" href="../articles/modelscomparison.html">Models comparison</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gpitt71/clmplus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Models comparison</h1>
                        <h4 data-toc-skip class="author">Gabriele
Pittarello</h4>
            
            <h4 data-toc-skip class="date">2025-06-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gpitt71/clmplus/blob/main/vignettes/modelscomparison.Rmd" class="external-link"><code>vignettes/modelscomparison.Rmd</code></a></small>
      <div class="d-none name"><code>modelscomparison.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we compare the performance of the claim development
models implemented in the <code>clmplus</code> package with the
performance of the claim amount models available in the <code>apc</code>
package (<span class="citation">Fannon and Nielsen (2020)</span>). The
comparison is performed based on the error incidence on the reserve
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">EI</mtext><mi>R</mi></msub><annotation encoding="application/x-tex">\text{EI}_R</annotation></semantics></math>,
defined below).</p>
<p>The code replicates on a smaller number of datasets the analysis in
section <em>4.3. Benchmarking on Multiple Data Sets</em> of the
manuscript <span class="citation">Pittarello, Hiabu, and Villegas
(2025)</span>. We will use publicly available datasets from the R
packages <code>clmplus</code>, <code>ChainLadder</code>, and
<code>apc</code> for this comparison.</p>
<p>Let us denote with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>,</mo><mi>j</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">k,j=0, \ldots, m</annotation></semantics></math>
the accident period and the development period respectively. The error
incidence on the reserve is defined in the manuscript as the sum of the
predicted incremental payments for calendar periods larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
(the claims reserve,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mrow><mi>k</mi><mo>+</mo><mi>j</mi><mo>&gt;</mo><mi>m</mi></mrow></msub><msub><mover><mi>X</mi><mo accent="true">̂</mo></mover><mrow><mi>k</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_{k+j&gt;m} \widehat{X}_{k j}</annotation></semantics></math>)
to the sum of true incremental payments for calendar periods larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">EI</mtext><mi>R</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">|</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>k</mi><mo>+</mo><mi>j</mi><mo>&gt;</mo><mi>m</mi></mrow></munder><msub><mover><mi>X</mi><mo accent="true">̂</mo></mover><mrow><mi>k</mi><mi>j</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mrow><mi>k</mi><mo>+</mo><mi>j</mi><mo>&gt;</mo><mi>m</mi></mrow></munder><msub><mi>X</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">|</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\text{EI}_R = \left|\frac{\sum_{k+j&gt;m} \widehat{X}_{k j}}{\sum_{k+j&gt;m} X_{k j}}-1\right|.
</annotation></semantics></math></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">list.of.datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  GenIns<span class="op">=</span><span class="va">GenIns</span>,</span>
<span>  sifa.mod<span class="op">=</span><span class="va">sifa.mod</span>,</span>
<span>  sifa.gtpl<span class="op">=</span><span class="va">sifa.gtpl</span>,</span>
<span>  sifa.mtpl<span class="op">=</span><span class="va">sifa.mtpl</span>,</span>
<span>  amases.gtpl<span class="op">=</span><span class="va">amases.gtpl</span>,</span>
<span>  amases.mod<span class="op">=</span><span class="va">amases.mod</span>,</span>
<span>  amases.mtpl<span class="op">=</span><span class="va">amases.mtpl</span>,</span>
<span>  bz <span class="op">=</span> <span class="fu">incr2cum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/apc/man/data.loss.BZ.html" class="external-link">data.loss.BZ</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">response</span><span class="op">)</span>,</span>
<span>  ta <span class="op">=</span> <span class="fu">incr2cum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/apc/man/data.loss.TA.html" class="external-link">data.loss.TA</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">response</span><span class="op">)</span>,</span>
<span>  xl <span class="op">=</span> <span class="fu">incr2cum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/apc/man/data.loss.XL.html" class="external-link">data.loss.XL</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">response</span><span class="op">)</span>,</span>
<span>  vnj <span class="op">=</span> <span class="fu">incr2cum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/apc/man/data.loss.VNJ.html" class="external-link">data.loss.VNJ</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">response</span><span class="op">)</span>,</span>
<span>  abc<span class="op">=</span><span class="va">ABC</span>,</span>
<span>  autoC<span class="op">=</span> <span class="va">auto</span><span class="op">$</span><span class="va">CommercialAutoPaid</span>,</span>
<span>  autoP <span class="op">=</span> <span class="va">auto</span><span class="op">$</span><span class="va">PersonalAutoPaid</span>,</span>
<span>  autoBI <span class="op">=</span> <span class="va">AutoBI</span><span class="op">$</span><span class="va">AutoBIPaid</span>,</span>
<span>  mclpaid<span class="op">=</span> <span class="va">MCLpaid</span>,</span>
<span>  medmal<span class="op">=</span><span class="va">MedMal</span><span class="op">$</span><span class="va">MedMalPaid</span>,</span>
<span>  mortgage<span class="op">=</span><span class="va">Mortgage</span>,</span>
<span>  mw08<span class="op">=</span><span class="va">MW2008</span>,</span>
<span>  mw14<span class="op">=</span><span class="va">MW2014</span>, </span>
<span>  ukmotor <span class="op">=</span> <span class="va">UKMotor</span>,</span>
<span>  usapaid<span class="op">=</span><span class="va">USAApaid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="code-for-section-4-3-1--models-ranking">Code for Section 4.3.1. Models Ranking<a class="anchor" aria-label="anchor" href="#code-for-section-4-3-1--models-ranking"></a>
</h2>
<p>We rank the different models based on a cross-validation scheme. The
training-validation split we use is represented in the following
picture.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># models ranking</span></span>
<span></span>
<span><span class="va">J</span><span class="op">=</span><span class="fl">12</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"origin"</span>,<span class="st">"dev"</span>,<span class="st">"value"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">origin</span><span class="op">+</span><span class="va">df</span><span class="op">$</span><span class="va">dev</span><span class="op">==</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">origin</span><span class="op">+</span><span class="va">df</span><span class="op">$</span><span class="va">dev</span><span class="op">&lt;</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">origin</span><span class="op">+</span><span class="va">df</span><span class="op">$</span><span class="va">dev</span><span class="op">&gt;=</span><span class="va">J</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span><span class="op">*</span><span class="va">J</span><span class="op">-</span><span class="va">J</span><span class="op">+</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">dev</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_y_reverse</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"royalblue"</span>, <span class="st">"darkred"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>                    na.value <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                    labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Train"</span>,<span class="st">"Validation"</span>,<span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Development year"</span>, y<span class="op">=</span><span class="st">"Accident year"</span>,fill<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, axis.text.x  <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, axis.text.y  <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_brewer</span><span class="op">(</span>guide <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelscomparison_files/figure-html/models%20ranking%20split-1.png" alt="Data split, Train and Validation." width="576"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">modelsranking.1d</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data.T</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="st">"</span></span>
<span><span class="st">  Function to rank the clmplus package and apc package age-period-cohort models.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  This function takes a triangle of cumulative payments as input.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  It returns the ranking on the triangle.</span></span>
<span><span class="st">  "</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">leave.out</span><span class="op">=</span><span class="fl">1</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">model.name</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">error.incidence</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">mre</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="co">#pre-processing</span></span>
<span>  <span class="va">triangle</span> <span class="op">&lt;-</span> <span class="va">data.T</span><span class="op">$</span><span class="va">cumulative.payments.triangle</span></span>
<span>  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">reduced.triangle</span> <span class="op">&lt;-</span> <span class="fu">c2t</span><span class="op">(</span><span class="fu">t2c</span><span class="op">(</span><span class="va">triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">newt.rtt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AggregateDataPP.html">AggregateDataPP</a></span><span class="op">(</span><span class="va">reduced.triangle</span><span class="op">)</span></span>
<span>  <span class="va">to.project</span> <span class="op">&lt;-</span> <span class="fu">t2c</span><span class="op">(</span><span class="va">triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">]</span></span>
<span>  <span class="va">true.values</span> <span class="op">&lt;-</span> <span class="fu">t2c</span><span class="op">(</span><span class="va">triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span>,<span class="va">J</span><span class="op">]</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">ix</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'ac'</span>,<span class="st">'ap'</span>,<span class="st">'apc'</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">hz.fit</span> <span class="op">&lt;-</span> <span class="fu">StMoMo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/StMoMo/man/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">ix</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                          Dxt <span class="op">=</span> <span class="va">newt.rtt</span><span class="op">$</span><span class="va">occurrance</span>, </span>
<span>                          Ext <span class="op">=</span> <span class="va">newt.rtt</span><span class="op">$</span><span class="va">exposure</span>,</span>
<span>                          wxt<span class="op">=</span><span class="va">newt.rtt</span><span class="op">$</span><span class="va">fit.w</span>,</span>
<span>                          iterMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1e+05</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">hz.rate</span> <span class="op">=</span> <span class="fu">fcst.fn</span><span class="op">(</span><span class="va">hz.fit</span>,</span>
<span>                   hazard.model <span class="op">=</span> <span class="va">ix</span>,</span>
<span>                   gk.fc.model <span class="op">=</span> <span class="st">'a'</span>,</span>
<span>                   ckj.fc.model<span class="op">=</span> <span class="st">'a'</span><span class="op">)</span><span class="op">$</span><span class="va">rates</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">fij</span> <span class="op">=</span> <span class="op">(</span><span class="fl">2</span><span class="op">+</span><span class="va">hz.rate</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">-</span><span class="va">hz.rate</span><span class="op">)</span></span>
<span>    <span class="va">pred.fij</span> <span class="op">=</span> <span class="va">fij</span><span class="op">[</span><span class="op">(</span><span class="va">leave.out</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fij</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">pred.v</span><span class="op">=</span><span class="va">to.project</span><span class="op">*</span><span class="va">pred.fij</span></span>
<span>    </span>
<span>    <span class="va">r.errors</span> <span class="op">=</span> <span class="op">(</span><span class="va">pred.v</span><span class="op">-</span><span class="va">true.values</span><span class="op">)</span><span class="op">/</span><span class="va">true.values</span></span>
<span>    <span class="va">error.inc.num</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pred.v</span><span class="op">-</span><span class="va">true.values</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>    <span class="va">error.inc.den</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">true.values</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">model.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model.name</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'clmplus.'</span>,<span class="va">ix</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">error.incidence</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">error.incidence</span>,<span class="va">error.inc.num</span><span class="op">/</span><span class="va">error.inc.den</span><span class="op">)</span></span>
<span>    <span class="va">mre</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mre</span>,<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">r.errors</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># ix='lc'</span></span>
<span>  <span class="co"># hz.fit &lt;- fit.lc.nr(data.T = newt.rtt,</span></span>
<span>  <span class="co">#                     iter.max = 3e+04)</span></span>
<span>  <span class="co"># if(hz.fit$converged==TRUE){hz.rate = forecast.lc.nr(hz.fit,J=dim(newt.rtt$cumulative.payments.triangle)[2])$rates[,1:leave.out]</span></span>
<span>  <span class="co"># fij = (2+hz.rate)/(2-hz.rate)</span></span>
<span>  <span class="co"># pred.fij = fij[(leave.out+1):length(fij)]</span></span>
<span>  <span class="co"># pred.v=to.project*pred.fij</span></span>
<span>  <span class="co"># r.errors = (pred.v-true.values)/true.values</span></span>
<span>  <span class="co"># </span></span>
<span>  <span class="co"># error.inc.num = sum(pred.v-true.values,na.rm = T)</span></span>
<span>  <span class="co"># error.inc.den = sum(true.values)</span></span>
<span>  <span class="co"># </span></span>
<span>  <span class="co"># model.name = c(model.name,</span></span>
<span>  <span class="co">#                paste0('clmplus.',ix))</span></span>
<span>  <span class="co"># error.incidence = c(error.incidence,error.inc.num/error.inc.den)</span></span>
<span>  <span class="co"># mre = c(mre,mean(r.errors))}</span></span>
<span>  </span>
<span>  <span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">model.name</span>,</span>
<span>    <span class="co"># mre,</span></span>
<span>    <span class="va">error.incidence</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## APC package</span></span>
<span>  </span>
<span>  <span class="va">newt.apc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.data.list.html" class="external-link">apc.data.list</a></span><span class="op">(</span>response<span class="op">=</span><span class="va">newt.rtt</span><span class="op">$</span><span class="va">incremental.payments.triangle</span>,</span>
<span>                            data.format<span class="op">=</span><span class="st">"CL"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## apc</span></span>
<span>  </span>
<span>  <span class="va">rmse</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">mae</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">error.pc</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">model.name</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">error.incidence</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">model.family</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">mre</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="va">true.inc.values</span> <span class="op">&lt;-</span> <span class="fu">t2c</span><span class="op">(</span><span class="va">data.T</span><span class="op">$</span><span class="va">incremental.payments.triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span>,<span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">J</span><span class="op">]</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">apc.mods</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AC"</span>,<span class="st">"APC"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#,"AP"</span></span>
<span>    </span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.fit.model.html" class="external-link">apc.fit.model</a></span><span class="op">(</span><span class="va">newt.apc</span>,</span>
<span>                         model.family <span class="op">=</span> <span class="st">"od.poisson.response"</span>,</span>
<span>                         model.design <span class="op">=</span> <span class="va">apc.mods</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">apc.mods</span> <span class="op">==</span> <span class="st">"AC"</span><span class="op">)</span><span class="op">{</span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.forecast.ac.html" class="external-link">apc.forecast.ac</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">trap.response.forecast</span><span class="op">}</span></span>
<span>    <span class="co"># if(apc.mods == "AP"){fcst &lt;- apc.forecast.ap(fit)$trap.response.forecast}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">apc.mods</span> <span class="op">==</span> <span class="st">"APC"</span><span class="op">)</span><span class="op">{</span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.forecast.apc.html" class="external-link">apc.forecast.apc</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">trap.response.forecast</span><span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">plogram.hat</span> <span class="op">=</span> <span class="fu">t2c.full.square</span><span class="op">(</span><span class="fu">incr2cum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">pred.v</span> <span class="op">=</span> <span class="va">plogram.hat</span><span class="op">[</span>,<span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">J</span><span class="op">]</span></span>
<span>    <span class="va">pred.v</span> <span class="op">=</span> <span class="va">pred.v</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pred.v</span><span class="op">)</span><span class="op">]</span></span>
<span>    </span>
<span>    </span>
<span>    <span class="va">r.errors</span> <span class="op">=</span> <span class="op">(</span><span class="va">pred.v</span><span class="op">-</span><span class="va">true.values</span><span class="op">)</span><span class="op">/</span><span class="va">true.values</span></span>
<span>    <span class="va">error.inc.num</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pred.v</span><span class="op">-</span><span class="va">true.values</span><span class="op">)</span></span>
<span>    <span class="va">error.inc.den</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">true.values</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">model.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model.name</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'apc.'</span>,<span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">apc.mods</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">error.incidence</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">error.incidence</span>,<span class="va">error.inc.num</span><span class="op">/</span><span class="va">error.inc.den</span><span class="op">)</span></span>
<span>    <span class="va">mre</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mre</span>,<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">r.errors</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">model.name</span>,</span>
<span>    <span class="co"># mre,</span></span>
<span>    <span class="va">error.incidence</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">out1</span>,<span class="va">out2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out3</span> <span class="op">&lt;-</span> <span class="va">out3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span>,decreasing <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">out3</span><span class="op">[</span>,<span class="st">'ei.rank'</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">out3</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># out3[,'mre.rank']=order(abs(out3$mre),decreasing = F)</span></span>
<span>  <span class="co">#fix it manually</span></span>
<span>  <span class="va">r2set</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">==</span><span class="st">'apc.ac'</span><span class="op">]</span>,</span>
<span>            <span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">==</span><span class="st">'clmplus.a'</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">==</span><span class="st">'apc.ac'</span><span class="op">]</span><span class="op">=</span><span class="va">r2set</span></span>
<span>  <span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">==</span><span class="st">'clmplus.a'</span><span class="op">]</span><span class="op">=</span><span class="va">r2set</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span> <span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">==</span><span class="st">'apc.ac'</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cond</span><span class="op">=</span><span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">&gt;</span><span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">==</span><span class="st">'apc.ac'</span><span class="op">]</span></span>
<span>    <span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span><span class="op">=</span><span class="va">out3</span><span class="op">$</span><span class="va">ei.rank</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>models.ranks<span class="op">=</span><span class="va">out3</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">modelsranking</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">list.of.datasets</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="st">"</span></span>
<span><span class="st">  This functions returns the datasets to plot in the ranking section of the paper.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  The input is a list of datasets that constitue the sample. </span></span>
<span><span class="st">  </span></span>
<span><span class="st">  The output is the rankings across different data sources.</span></span>
<span><span class="st">  "</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">full.ranks</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">df.ix</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">list.of.datasets</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">out.df</span><span class="op">=</span><span class="fu">modelsranking.1d</span><span class="op">(</span><span class="fu"><a href="../reference/AggregateDataPP.html">AggregateDataPP</a></span><span class="op">(</span><span class="va">list.of.datasets</span><span class="op">[[</span><span class="va">df.ix</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">out.df</span><span class="op">$</span><span class="va">models.ranks</span><span class="op">[</span>,<span class="st">'data.source'</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">df.ix</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">out.df</span><span class="op">$</span><span class="va">models.ranks</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">full.ranks</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">full.ranks</span>,<span class="va">out.df</span><span class="op">$</span><span class="va">models.ranks</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>full.ranks<span class="op">=</span><span class="va">full.ranks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_min_expd0</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">full.ranks</span><span class="op">$</span><span class="va">full.ranks</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">model.name</span>, <span class="va">data.source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">ei.rank</span>, breaks<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">6</span>, labels<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">ggtitle</span><span class="op">(</span><span class="st">" "</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">ei.rank</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">scale_y_discrete</span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">list.of.datasets</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">scale_fill_manual</span><span class="op">(</span>drop<span class="op">=</span><span class="cn">FALSE</span>, values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="st">"#6699CC"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, na.value<span class="op">=</span><span class="st">"#EEEEEE"</span>, name<span class="op">=</span><span class="st">"Rank"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">xlab</span><span class="op">(</span><span class="st">"Model"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Data source"</span><span class="op">)</span></span>
<span><span class="va">p_min_expd0</span></span></code></pre></div>
<p><img src="modelscomparison_files/figure-html/ranking%20plot-1.png" alt="Models ranking plot." width="576"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span><span class="op">=</span><span class="va">full.ranks</span><span class="op">$</span><span class="va">full.ranks</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">model.name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ei.rank</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   model.name  mean.rank</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> apc.ac           3.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> apc.apc          4.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> clmplus.a        3.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> clmplus.ac       2.32</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> clmplus.ap       3   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> clmplus.apc      2.45</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">temp.df</span><span class="op">=</span><span class="va">full.ranks</span><span class="op">$</span><span class="va">full.ranks</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'model.name'</span>,<span class="st">'ei.rank'</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">model.name</span>, <span class="va">ei.rank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'model.name'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre></div>
<p>The following picture was not included in the paper but it shows the
models ranks counts for each model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">temp.df</span>, <span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">count</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ei.rank</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>position<span class="op">=</span><span class="st">"stack"</span>, stat<span class="op">=</span><span class="st">"identity"</span>,fill<span class="op">=</span><span class="st">'#6699CC'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">model.name</span>, scales<span class="op">=</span><span class="st">'free'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Rank"</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelscomparison_files/figure-html/plot%20ranks-1.png" alt="Model rank count." width="576"></p>
</div>
<div class="section level2">
<h2 id="code-for-section-4-3-2--model-families-comparison">Code for Section 4.3.2. Model Families Comparison<a class="anchor" aria-label="anchor" href="#code-for-section-4-3-2--model-families-comparison"></a>
</h2>
<p>We evaluate the out-of-sample performance of our models by using a
training, validation and testing split.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">J</span><span class="op">=</span><span class="fl">12</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"origin"</span>,<span class="st">"dev"</span>,<span class="st">"value"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">origin</span><span class="op">+</span><span class="va">df</span><span class="op">$</span><span class="va">dev</span><span class="op">==</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">origin</span><span class="op">+</span><span class="va">df</span><span class="op">$</span><span class="va">dev</span><span class="op">&lt;</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">origin</span><span class="op">+</span><span class="va">df</span><span class="op">$</span><span class="va">dev</span><span class="op">==</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">origin</span><span class="op">+</span><span class="va">df</span><span class="op">$</span><span class="va">dev</span><span class="op">&gt;=</span><span class="va">J</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#nas in the lower</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span><span class="op">+</span><span class="va">J</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span><span class="op">*</span><span class="va">J</span><span class="op">-</span><span class="va">J</span><span class="op">+</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span><span class="op">*</span><span class="va">J</span><span class="op">-</span><span class="va">J</span><span class="op">+</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#nas in the upper tail</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span><span class="op">*</span><span class="va">J</span><span class="op">-</span><span class="va">J</span><span class="op">+</span><span class="fl">1</span><span class="op">-</span><span class="fl">12</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">J</span><span class="op">*</span><span class="va">J</span><span class="op">-</span><span class="va">J</span><span class="op">+</span><span class="fl">2</span><span class="op">-</span><span class="fl">12</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">dev</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_y_reverse</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"royalblue"</span>, <span class="st">"darkred"</span>, <span class="st">"darkgreen"</span>,<span class="st">"white"</span><span class="op">)</span>,</span>
<span>                    na.value <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                    labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Train"</span>,<span class="st">"Validation"</span>,<span class="st">"Test"</span>,<span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Development year"</span>, y<span class="op">=</span><span class="st">"Accident year"</span>,fill<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, axis.text.x  <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, axis.text.y  <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_brewer</span><span class="op">(</span>guide <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelscomparison_files/figure-html/bake%20off%20split-1.png" alt="Data split, Train, Validation, and Test." width="576"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best.of.the.bests</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df1</span>,<span class="va">df2</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="st">"</span></span>
<span><span class="st">  Util to turn character columns values into numeric.</span></span>
<span><span class="st">  "</span></span>
<span>  </span>
<span>  <span class="va">df1</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df1</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">as.numeric</span><span class="op">)</span></span>
<span>  <span class="va">df2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df2</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">as.numeric</span><span class="op">)</span></span>
<span>  <span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df1</span>,<span class="va">df2</span><span class="op">)</span></span>
<span>  <span class="va">df3</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df3</span>,FUN<span class="op">=</span><span class="va">abs.min</span>,MARGIN <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df3</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">modelcomparison.1d</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cumulative.payments.triangle</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="st">"</span></span>
<span><span class="st">  Function to compare the clmplus package age-period-cohort models with apc package age-period-cohort models  performances across different triangles.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  This function takes a triangle of cumulative payments as input.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  It returns the accuracy measures for the two families on the triangle.</span></span>
<span><span class="st">  "</span></span>
<span>  <span class="co"># function internal variables</span></span>
<span>  </span>
<span>  <span class="va">leave.out</span><span class="op">=</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="va">rmse</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">mae</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">error.pc</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">model.name</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">error.incidence</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">model.family</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">mre</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="co"># data pre-precessing ----</span></span>
<span>  </span>
<span>  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cumulative.payments.triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">reduced.triangle</span> <span class="op">&lt;-</span> <span class="fu">c2t</span><span class="op">(</span><span class="fu">t2c</span><span class="op">(</span><span class="va">cumulative.payments.triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">newt.rtt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AggregateDataPP.html">AggregateDataPP</a></span><span class="op">(</span><span class="va">reduced.triangle</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">newt.apc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.data.list.html" class="external-link">apc.data.list</a></span><span class="op">(</span>response<span class="op">=</span><span class="va">newt.rtt</span><span class="op">$</span><span class="va">incremental.payments.triangle</span>,</span>
<span>                            data.format<span class="op">=</span><span class="st">"CL"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## stmomo -----</span></span>
<span>  <span class="va">to.project</span> <span class="op">&lt;-</span> <span class="fu">t2c</span><span class="op">(</span><span class="va">cumulative.payments.triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">]</span></span>
<span>  <span class="va">true.values</span> <span class="op">&lt;-</span> <span class="fu">t2c</span><span class="op">(</span><span class="va">cumulative.payments.triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span>,<span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">J</span><span class="op">]</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">ix</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'ac'</span>,<span class="st">'ap'</span>,<span class="st">'apc'</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">##names(models)</span></span>
<span>    </span>
<span>    <span class="va">hz.fit</span> <span class="op">&lt;-</span> <span class="fu">StMoMo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/StMoMo/man/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">models</span><span class="op">[[</span><span class="va">ix</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                          Dxt <span class="op">=</span> <span class="va">newt.rtt</span><span class="op">$</span><span class="va">occurrance</span>, </span>
<span>                          Ext <span class="op">=</span> <span class="va">newt.rtt</span><span class="op">$</span><span class="va">exposure</span>,</span>
<span>                          wxt<span class="op">=</span><span class="va">newt.rtt</span><span class="op">$</span><span class="va">fit.w</span>,</span>
<span>                          iterMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1e+05</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">hz.rate</span> <span class="op">=</span> <span class="fu">fcst.fn</span><span class="op">(</span><span class="va">hz.fit</span>,</span>
<span>                   hazard.model <span class="op">=</span> <span class="va">ix</span>,</span>
<span>                   gk.fc.model <span class="op">=</span> <span class="st">'a'</span>,</span>
<span>                   ckj.fc.model<span class="op">=</span> <span class="st">'a'</span><span class="op">)</span><span class="op">$</span><span class="va">rates</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">leave.out</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">J.new</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">reduced.triangle</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">fij</span> <span class="op">=</span> <span class="op">(</span><span class="fl">2</span><span class="op">+</span><span class="va">hz.rate</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">-</span><span class="va">hz.rate</span><span class="op">)</span></span>
<span>    <span class="va">pred.mx</span> <span class="op">=</span> <span class="va">fij</span></span>
<span>    <span class="va">pred.mx</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="va">fij</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">to.project</span><span class="op">)</span></span>
<span>    <span class="va">temp</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">pred.mx</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J.new</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pred.mx</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">J.new</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">pred.mx</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="va">fij</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">J.new</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>,<span class="va">temp</span><span class="op">)</span></span>
<span>    <span class="va">true.mx</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">true.values</span><span class="op">)</span></span>
<span>    <span class="co"># this is meant to be NA</span></span>
<span>    <span class="va">true.mx</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="cn">NA</span></span>
<span>  </span>
<span>    <span class="va">sq.errors</span> <span class="op">=</span> <span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="va">abs.errors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span><span class="op">)</span></span>
<span>    <span class="va">r.errors</span> <span class="op">=</span> <span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span><span class="op">)</span><span class="op">/</span><span class="va">true.mx</span></span>
<span>    <span class="va">error.inc.num</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span>,<span class="va">sum</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>    <span class="va">error.inc.den</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">true.mx</span>,<span class="va">sum</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>    <span class="va">model.name.ix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ix</span>,<span class="st">".val"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ix</span>,<span class="st">".test"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">model.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model.name</span>,<span class="va">model.name.ix</span><span class="op">)</span></span>
<span>    <span class="va">model.family</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model.family</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ix</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rmse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rmse</span>,<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">sq.errors</span>,MARGIN <span class="op">=</span> <span class="fl">2</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mae</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mae</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">abs.errors</span>,MARGIN <span class="op">=</span> <span class="fl">2</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mre</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mre</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">r.errors</span>,MARGIN <span class="op">=</span> <span class="fl">2</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">error.incidence</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">error.incidence</span>,<span class="va">error.inc.num</span><span class="op">/</span><span class="va">error.inc.den</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  </span>
<span>  <span class="co">## stmomo results ---- </span></span>
<span>  </span>
<span>   <span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">model.name</span>,</span>
<span>    <span class="va">model.family</span>,</span>
<span>    <span class="va">mre</span>,</span>
<span>    <span class="va">error.incidence</span>,</span>
<span>    <span class="va">rmse</span>,</span>
<span>    <span class="va">mae</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">temp.ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">".val"</span>, <span class="va">model.name</span><span class="op">)</span></span>
<span>  <span class="va">temp.df</span> <span class="op">&lt;-</span> <span class="va">out1</span><span class="op">[</span><span class="va">temp.ix</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    rmse<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    mre<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    mae<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    error.incidence<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  </span>
<span>  <span class="va">temp.ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">".test"</span>, <span class="va">model.name</span><span class="op">)</span></span>
<span>  <span class="va">out3</span> <span class="op">&lt;-</span> <span class="va">out1</span><span class="op">[</span><span class="va">temp.ix</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">best.df</span> <span class="op">=</span> <span class="va">out2</span></span>
<span>  <span class="va">best.df</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">=</span><span class="cn">NA</span></span>
<span>  </span>
<span>  <span class="va">out.test.min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    rmse<span class="op">=</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    mre<span class="op">=</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    mae<span class="op">=</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    error.incidence<span class="op">=</span><span class="va">out3</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out3</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">temp.mx</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="va">out2</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="va">out.test.min</span><span class="op">)</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">choices.mx.clmplus</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="va">out2</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">agreement.frame.clmplus</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">temp.mx</span><span class="op">)</span></span>
<span>  <span class="va">choices.frame.clmplus</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">choices.mx.clmplus</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">agreement.frame.clmplus</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">choices.frame.clmplus</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">col.ix</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">res</span><span class="op">=</span><span class="va">out1</span><span class="op">$</span><span class="va">model.family</span><span class="op">[</span><span class="va">out1</span><span class="op">$</span><span class="va">model.name</span> <span class="op">==</span> <span class="va">out2</span><span class="op">[</span><span class="fl">1</span>,<span class="va">col.ix</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">res.test</span> <span class="op">=</span> <span class="va">out3</span><span class="op">$</span><span class="va">model.family</span> <span class="op">==</span> <span class="va">res</span></span>
<span>  <span class="va">best.df</span><span class="op">[</span><span class="fl">1</span>,<span class="va">col.ix</span><span class="op">]</span> <span class="op">=</span> <span class="va">out3</span><span class="op">[</span><span class="va">res.test</span>,<span class="va">col.ix</span><span class="op">]</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">families.set</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'apc'</span><span class="op">)</span> <span class="co">#'ap',</span></span>
<span>  <span class="va">temp.ix</span> <span class="op">=</span> <span class="va">out3</span><span class="op">$</span><span class="va">model.family</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">families.set</span></span>
<span>  <span class="va">comparison.df</span> <span class="op">=</span> <span class="va">out3</span><span class="op">[</span><span class="va">temp.ix</span>,<span class="op">]</span></span>
<span>  <span class="va">comparison.df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">comparison.df</span>,</span>
<span>                        approach<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'clmplus'</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">families.set</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  </span>
<span>  <span class="co">## apc ----</span></span>
<span>  </span>
<span>  <span class="va">rmse</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">mae</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">error.pc</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">model.name</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">error.incidence</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">model.family</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">mre</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="va">true.inc.values</span> <span class="op">&lt;-</span> <span class="fu">t2c</span><span class="op">(</span><span class="fu">cum2incr</span><span class="op">(</span><span class="va">cumulative.payments.triangle</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">)</span>,<span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">J</span><span class="op">]</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">apc.mods</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AC"</span>,<span class="st">"APC"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#,"AP"</span></span>
<span>    </span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.fit.model.html" class="external-link">apc.fit.model</a></span><span class="op">(</span><span class="va">newt.apc</span>,</span>
<span>                         model.family <span class="op">=</span> <span class="st">"od.poisson.response"</span>,</span>
<span>                         model.design <span class="op">=</span> <span class="va">apc.mods</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">apc.mods</span> <span class="op">==</span> <span class="st">"AC"</span><span class="op">)</span><span class="op">{</span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.forecast.ac.html" class="external-link">apc.forecast.ac</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">trap.response.forecast</span><span class="op">}</span></span>
<span>    <span class="co"># if(apc.mods == "AP"){fcst &lt;- apc.forecast.ap(fit)$trap.response.forecast}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">apc.mods</span> <span class="op">==</span> <span class="st">"APC"</span><span class="op">)</span><span class="op">{</span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/apc/man/apc.forecast.apc.html" class="external-link">apc.forecast.apc</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">trap.response.forecast</span><span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">plogram.hat</span> <span class="op">=</span> <span class="fu">t2c.full.square</span><span class="op">(</span><span class="fu">incr2cum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">pred.mx</span> <span class="op">=</span> <span class="va">plogram.hat</span><span class="op">[</span>,<span class="op">(</span><span class="va">J</span><span class="op">-</span><span class="va">leave.out</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">J</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co"># true.mx= rbind(rep(NA,2),true.inc.values)</span></span>
<span>    <span class="co"># # this is meant to be NA</span></span>
<span>    <span class="co"># true.mx[2,2]=NA</span></span>
<span>  </span>
<span>    <span class="va">sq.errors</span> <span class="op">=</span> <span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="va">abs.errors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span><span class="op">)</span></span>
<span>    <span class="va">r.errors</span> <span class="op">=</span> <span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span><span class="op">)</span><span class="op">/</span><span class="va">true.mx</span> <span class="co">#use same benchmark</span></span>
<span>    <span class="va">error.inc.num</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pred.mx</span><span class="op">-</span><span class="va">true.mx</span>,<span class="va">sum</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>    <span class="va">error.inc.den</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">true.mx</span>,<span class="va">sum</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="co">#use same benchmark</span></span>
<span>    <span class="va">model.name.ix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">apc.mods</span>,<span class="st">".val"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">apc.mods</span>,<span class="st">".test"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">model.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model.name</span>,<span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">model.name.ix</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">model.family</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model.family</span>,<span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">apc.mods</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rmse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rmse</span>,<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">sq.errors</span>,MARGIN <span class="op">=</span> <span class="fl">2</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mae</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mae</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">abs.errors</span>,MARGIN <span class="op">=</span> <span class="fl">2</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mre</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mre</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">r.errors</span>,MARGIN <span class="op">=</span> <span class="fl">2</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">error.incidence</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">error.incidence</span>,<span class="va">error.inc.num</span><span class="op">/</span><span class="va">error.inc.den</span><span class="op">)</span><span class="op">}</span></span>
<span>    </span>
<span>      </span>
<span>   <span class="va">out4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">model.name</span>,</span>
<span>    <span class="va">model.family</span>,</span>
<span>    <span class="va">mre</span>,</span>
<span>    <span class="va">error.incidence</span>,</span>
<span>    <span class="va">rmse</span>,</span>
<span>    <span class="va">mae</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">temp.ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">".val"</span>, <span class="va">model.name</span><span class="op">)</span></span>
<span>  <span class="va">temp.df</span> <span class="op">&lt;-</span> <span class="va">out4</span><span class="op">[</span><span class="va">temp.ix</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">out5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    rmse<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    mre<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    mae<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    error.incidence<span class="op">=</span><span class="va">temp.df</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">temp.df</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">temp.ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">".test"</span>, <span class="va">model.name</span><span class="op">)</span></span>
<span>  <span class="va">out6</span> <span class="op">&lt;-</span> <span class="va">out4</span><span class="op">[</span><span class="va">temp.ix</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">out.test.min2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  rmse<span class="op">=</span><span class="va">out6</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">rmse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  mre<span class="op">=</span><span class="va">out6</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">mre</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  mae<span class="op">=</span><span class="va">out6</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">mae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  error.incidence<span class="op">=</span><span class="va">out6</span><span class="op">$</span><span class="va">model.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out6</span><span class="op">$</span><span class="va">error.incidence</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">temp.mx</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="va">out5</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="va">out.test.min2</span><span class="op">)</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">choices.mx.apc</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="va">out5</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">choices.frame.apc</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">choices.mx.apc</span><span class="op">)</span></span>
<span>  <span class="va">agreement.frame.apc</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">temp.mx</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">agreement.frame.apc</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">choices.frame.apc</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">best.df.apc</span> <span class="op">=</span> <span class="va">out5</span></span>
<span>  <span class="va">best.df.apc</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">=</span><span class="cn">NA</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">col.ix</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">res</span><span class="op">=</span><span class="va">out4</span><span class="op">$</span><span class="va">model.family</span><span class="op">[</span><span class="va">out4</span><span class="op">$</span><span class="va">model.name</span> <span class="op">==</span> <span class="va">out5</span><span class="op">[</span><span class="fl">1</span>,<span class="va">col.ix</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">res.test</span> <span class="op">=</span> <span class="va">out6</span><span class="op">$</span><span class="va">model.family</span> <span class="op">==</span> <span class="va">res</span></span>
<span>  <span class="va">best.df.apc</span><span class="op">[</span><span class="fl">1</span>,<span class="va">col.ix</span><span class="op">]</span> <span class="op">=</span> <span class="va">out6</span><span class="op">[</span><span class="va">res.test</span>,<span class="va">col.ix</span><span class="op">]</span><span class="op">}</span></span>
<span>      </span>
<span>  <span class="va">families.set</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ac'</span>,<span class="st">'apc'</span><span class="op">)</span> <span class="co">#'ap',</span></span>
<span>  <span class="va">temp.ix</span> <span class="op">=</span> <span class="va">out6</span><span class="op">$</span><span class="va">model.family</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">families.set</span></span>
<span>  <span class="va">comparison.df.apc</span> <span class="op">=</span> <span class="va">out6</span><span class="op">[</span><span class="va">temp.ix</span>,<span class="op">]</span></span>
<span>  <span class="va">comparison.df.apc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">comparison.df.apc</span>,</span>
<span>                            approach<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'apc'</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">families.set</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    best.model.clmplus <span class="op">=</span> <span class="va">best.df</span>,</span>
<span>    best.model.apc <span class="op">=</span> <span class="va">best.df.apc</span>,</span>
<span>    agreement.frame.clmplus<span class="op">=</span><span class="va">agreement.frame.clmplus</span>,</span>
<span>    agreement.frame.apc<span class="op">=</span><span class="va">agreement.frame.apc</span>,</span>
<span>    choices.frame.clmplus<span class="op">=</span><span class="va">choices.frame.clmplus</span>,</span>
<span>    choices.frame.apc<span class="op">=</span><span class="va">choices.frame.apc</span>,</span>
<span>    comparison.df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">comparison.df</span>,</span>
<span>                          <span class="va">comparison.df.apc</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">}</span></span>
<span>  </span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">modelcomparison</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">list.of.datasets</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="st">"This functions returns the datasets to plot the bake-off section of the paper.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  The input is a list of datasets that constitue the sample. </span></span>
<span><span class="st">  </span></span>
<span><span class="st">  The output is datasets that contain accuracy measures.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  "</span></span>
<span>  <span class="va">best.fit</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>  <span class="va">families.fit</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>  <span class="va">agreement.clmplus</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>  <span class="va">agreement.apc</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>  <span class="va">choices.clmplus</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>  <span class="va">choices.apc</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">df.ix</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">list.of.datasets</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">".. Comparison on dataset: "</span>,<span class="va">df.ix</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">out.ix</span> <span class="op">=</span> <span class="fu">modelcomparison.1d</span><span class="op">(</span><span class="va">list.of.datasets</span><span class="op">[[</span><span class="va">df.ix</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">best.of.the.bests.df</span><span class="op">=</span><span class="fu">best.of.the.bests</span><span class="op">(</span><span class="va">out.ix</span><span class="op">$</span><span class="va">best.model.clmplus</span>,</span>
<span>                                        <span class="va">out.ix</span><span class="op">$</span><span class="va">best.model.apc</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">out.ix</span><span class="op">$</span><span class="va">best.model.clmplus</span><span class="op">[</span><span class="st">'package'</span><span class="op">]</span><span class="op">=</span> <span class="st">'clmplus'</span></span>
<span>    <span class="va">out.ix</span><span class="op">$</span><span class="va">best.model.apc</span><span class="op">[</span><span class="st">'package'</span><span class="op">]</span><span class="op">=</span> <span class="st">'apc'</span></span>
<span>    <span class="va">best.of.the.bests.df</span><span class="op">[</span><span class="st">'package'</span><span class="op">]</span><span class="op">=</span><span class="st">'overall.best'</span></span>
<span>    </span>
<span>    <span class="va">best.fit</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">best.fit</span>,</span>
<span>                   <span class="va">out.ix</span><span class="op">$</span><span class="va">best.model.clmplus</span>,</span>
<span>                   <span class="va">out.ix</span><span class="op">$</span><span class="va">best.model.apc</span>,</span>
<span>                   <span class="va">best.of.the.bests.df</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">families.fit</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">families.fit</span>,</span>
<span>                   <span class="va">out.ix</span><span class="op">$</span><span class="va">comparison.df</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">agreement.clmplus</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">agreement.clmplus</span>,</span>
<span>                         <span class="va">out.ix</span><span class="op">$</span><span class="va">agreement.frame.clmplus</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">agreement.apc</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">agreement.apc</span>,</span>
<span>                         <span class="va">out.ix</span><span class="op">$</span><span class="va">agreement.frame.apc</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">choices.clmplus</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">choices.clmplus</span>,</span>
<span>                         <span class="va">out.ix</span><span class="op">$</span><span class="va">choices.frame.clmplus</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">choices.apc</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">choices.apc</span>,</span>
<span>                         <span class="va">out.ix</span><span class="op">$</span><span class="va">choices.frame.apc</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">best.fit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">best.fit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,MARGIN <span class="op">=</span> <span class="fl">2</span>,FUN <span class="op">=</span> <span class="va">as.numeric</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">families.fit</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mre'</span>,</span>
<span>                  <span class="st">'error.incidence'</span>,</span>
<span>                  <span class="st">'rmse'</span>,</span>
<span>                  <span class="st">'mae'</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span></span>
<span>                    <span class="va">families.fit</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mre'</span>,</span>
<span>                                    <span class="st">'error.incidence'</span>,</span>
<span>                                    <span class="st">'rmse'</span>,</span>
<span>                                    <span class="st">'mae'</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    MARGIN <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    FUN <span class="op">=</span> <span class="va">as.numeric</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>best.fit<span class="op">=</span><span class="va">best.fit</span>,</span>
<span>             families.fit<span class="op">=</span><span class="va">families.fit</span>,</span>
<span>             agreement.clmplus<span class="op">=</span><span class="va">agreement.clmplus</span>,</span>
<span>             agreement.apc<span class="op">=</span><span class="va">agreement.apc</span>,</span>
<span>             choices.clmplus<span class="op">=</span><span class="va">choices.clmplus</span>,</span>
<span>             choices.apc<span class="op">=</span><span class="va">choices.apc</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">bake.off</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">models.comparison</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="st">"</span></span>
<span><span class="st">  This function plots out the results from the previous computations. </span></span>
<span><span class="st">  </span></span>
<span><span class="st">  It takes as input the resulting dataframes of model.comparison.</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  The output is the boxplots of the paper's bake-off section. </span></span>
<span><span class="st">  </span></span>
<span><span class="st">  "</span></span>
<span>  </span>
<span>  <span class="co"># browser()</span></span>
<span>  </span>
<span>  <span class="va">p1</span><span class="op">&lt;-</span> <span class="va">models.comparison</span><span class="op">$</span><span class="va">best.fit</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rmse"</span>,<span class="st">"mae"</span>,<span class="st">"package"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">package</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">package</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">name</span>,nrow <span class="op">=</span> <span class="fl">1</span>,strip.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">'outside'</span>,strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">p2</span><span class="op">&lt;-</span> <span class="va">models.comparison</span><span class="op">$</span><span class="va">best.fit</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mre"</span>,<span class="st">"error.incidence"</span>,<span class="st">"package"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">package</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">package</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">name</span>,nrow <span class="op">=</span> <span class="fl">1</span>,strip.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">'outside'</span>,strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>   <span class="va">abs.best</span><span class="op">=</span><span class="va">models.comparison</span><span class="op">$</span><span class="va">best.fit</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mre"</span>,<span class="st">"error.incidence"</span>,<span class="st">"package"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">abs.best</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mre"</span>,<span class="st">"error.incidence"</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">abs.best</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mre"</span>,<span class="st">"error.incidence"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                              MARGIN<span class="op">=</span><span class="fl">2</span>,</span>
<span>                                              FUN<span class="op">=</span><span class="va">abs</span><span class="op">)</span></span>
<span>  <span class="va">p3</span><span class="op">&lt;-</span> <span class="va">abs.best</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">package</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">package</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">name</span>,nrow <span class="op">=</span> <span class="fl">1</span>,strip.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">'outside'</span>,strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">only.ei</span><span class="op">=</span><span class="va">models.comparison</span><span class="op">$</span><span class="va">best.fit</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"error.incidence"</span>,<span class="st">"package"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">only.ei</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"error.incidence"</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">only.ei</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"error.incidence"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">p4</span><span class="op">&lt;-</span> <span class="va">abs.best</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">package</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">package</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># facet_wrap(.~name,nrow = 1,strip.position = 'bottom')+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">'outside'</span>,strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p1<span class="op">=</span><span class="va">p1</span>,</span>
<span>             p2<span class="op">=</span><span class="va">p2</span>,</span>
<span>             p3<span class="op">=</span><span class="va">p3</span>,</span>
<span>             p4<span class="op">=</span><span class="va">p4</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The models in the <code>clmplus</code> package are compared to those
in the <code>apc</code> package. Below it can be found the code we used
to create the box-plot in figure 8 of our paper.</p>
<p>For each case we are able to pick the best model based on the error
incidence.</p>
<p><img src="modelscomparison_files/figure-html/detail%20on%20ei-1.png" alt="Error Incidence." width="576"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-apcpackage" class="csl-entry">
Fannon, Zoe, and Bent Nielsen. 2020. <em>Apc: Age-Period-Cohort
Analysis</em>. <a href="https://CRAN.R-project.org/package=apc" class="external-link">https://CRAN.R-project.org/package=apc</a>.
</div>
<div id="ref-pittarello25" class="csl-entry">
Pittarello, Gabriele, Munir Hiabu, and Andrés M Villegas. 2025.
<span>“Replicating and Extending Chain-Ladder via an Age–Period–Cohort
Structure on the Claim Development in a Run-Off Triangle.”</span>
<em>North American Actuarial Journal</em>, 1–31.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gabriele Pittarello, Munir Hiabu, Andres Villegas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
